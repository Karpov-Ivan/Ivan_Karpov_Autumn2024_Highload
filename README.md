# Проектирование высоконагруженного сервиса интернет-магазина

# 1 Тема и целевая аудитория

## Тема

Маркетплейс Wildberries — российский международный интернет-магазин, предлагающий одежду, обувь, электронику, детские товары, товары для дома и другие категории товаров.

## MVP
1. Авторизация, регистрация по номеру телефона.
2. Поиск товаров по ключевым словам.
3. Функции сортировки по разным критериям, включая цену, популярность и новизну.
4. Добавление товаров в корзину.
5. Редактирование количества и удаление товаров.
6. Оставление отзывов о приобретённых товарах.
7. Оформление заказа.
8. Статус заказа при доставке.
9. Добавление товаров продавцом на площадку с учётом фотографии.
10. Авторизация, регистрация для продавцов.

## Продуктовые особенности
* Персонализированные предложения — пользователи получают индивидуальные рекомендации и специальные скидки на основе их предыдущих покупок и предпочтений. Система анализирует поведение клиента и предлагает наиболее релевантные товары, что повышает вероятность совершения покупок.
* Платежная система — удобная и безопасная система оплаты, которая поддерживает различные способы оплаты (банковские карты, электронные кошельки и другие), гарантируя комфорт и безопасность транзакций для пользователей.

## ЦА
Ниже представлена статистика исследования аудитории Wildberries.
Возраст целевой аудитории варьируется в диапазоне от 18 до 65+ лет. [[1]](https://www.similarweb.com/ru/website/wildberries.ru/#demographics)
Возрастная группа | Процентное соотношение
------------ | -------------
18-24 года| 14,31% 
25-34 года| 23,79% 
35-44 года| 18,11% 
45-54 года| 17,53% 
55-64 года| 14,78% 
65+   года| 11,48% 

Размер целевой аудитории: 58.7 млн. пользователей в месяц, 24.2 млн. пользователей в день на момент февраля 2024г. [[2]](https://oborot.ru/news/kolichestvo-posetitelej-marketplejsov-wildberries-i-ozon-v-mesyac-sravnyalos-kuda-eshhe-hodyat-pokupateli-i209527.html)

География пользователей:
Страна       | Процентное соотношение
-------------| -------------
Россия       | 93.05%
Беларусь     | 2.06% 
Казахстан    | 1.74%
Армения      | 0.53% 
Другие       | 2.63% 

Гендерное распределение аудитории Wildberries [[3]](https://dzen.ru/a/ZkT8wKCKkBgtJMT-):
Пол          | Процентное соотношение
-------------| -------------
Мужской      | 30.00%
Женский      | 70.00% 

# 2 Расчёт нагрузки

Продуктовые метрики:
Метрика      | Значение
-------------| -------------
Месячная аудитория MAU        | 58.7 млн. пользователей
Дневная аудитория DAU         | 24.2 млн. пользователей
Количество регистраций в день [[4]](https://adindex.ru/news/researches/2023/02/28/310879.phtml) | 40 тыс. пользователей
Средняя длительность сессии   [[5]](https://dzen.ru/a/ZkT8wKCKkBgtJMT-) | 11 минут
Количество заходов в день     [[6]](https://www.vedomosti.ru/business/articles/2024/05/05/1035562-ozon-i-wildberries) | 11 млн.

### Хранилище данных для пользователя

Параметр          | Число
-------------| -------------
Поиск товаров по ключевым словам           | 3 запросов/день
Добавление товаров в корзину               | 4 товаров/день
Оформление заказа                          | 1 заказов/день
Среднее количество товаров в заказе        | 3 товаров
Оставление отзывов                         | 2 отзывов/день
Средняя длина отзыва                       | 60 символов UTF-8
Средний количество фотографий у отзыва     | 3 шт.
Добавление товаров продавцом               | 1 товаров/день
Средний размер товара без учета фотографии | 6.3 кБ
Средний количество фотографий у товара     | 7 шт.
Средний размер фотографии товара           | 86 кБ

Объём данных на одного пользователя в день:
* Добавление товаров в корзину: 4 товара * (6.3 кБ + 7 * 86 кБ) = 2461.2 кБ
* Оформление заказа: 3 товара * (6.3 кБ + 7 * 86 кБ) = 1845.9 кБ
* Оставление отзывов: 2 отзыва * (0.06 кБ + 3 * 86 кБ) = 467.72 кБ

Тогда общий объем товаров в день, добавляемых в корзину, оформленых в заказе, оставление отзывов, на одного пользователя равен: 
4 * (6.3 (кБ) + 7 * 86 (кБ)) + 3 * (6.3 (кБ) + 7 * 86 (кБ)) + 2 * (0.06 (кБ) + 3 * 86 (кБ)) = 4774,82 кБ = 4.77 МБ

### Динамический рост

Так как за год заказывается около 618 млн. [[7]](https://www.cnews.ru/news/line/2023-06-08_wildberries_itogi_i_kvartala_2023) товаров, то можно вычислить, какой объем данных будет занят пользователями:
* Расчёт данных на товары (всего): (6.3 (кБ) + 7 * 86 (кБ)) * 618 млн. = 375.93 ТБ
* Расчёт данных только на фотографии товаров: 7 * 86 (кБ) * 618 млн. = 372.04 ТБ

### Сетевой трафик
При расчете сетевого трафика не будем учитывать запросы, связанные с регистрацией пользователей, так как они не создают ощутимую нагрузку на наш сервис.
Основная нагрузка приходится на оформление заказа, добавление в корзину и оставление отзывов.

### Предварительные расчеты:
### Трафик по видам активности на одного пользователя:
1. Поиск товаров:

* 3 запроса/день. Примерный объем одного запроса можно оценить в 10 кБ (запрос + ответ от сервера). Итого: 3 ∗ 10 кБ = 30 кБ

2. Добавление товаров в корзину:

* 4 товара/день. Объем данных на один товар — 6.3 кБ + 7 фото * 86 кБ = 2461.2 кБ (как уже рассчитано). Итого: 2461.2 кБ

3. Оформление заказа:

* 1 заказ в день с 3 товарами. Итого: 1845.9 кБ

4. Оставление отзывов:

* 2 отзыва/день, 467.72 кБ (как рассчитано ранее). Итого: 467.72 кБ

5. Трафик на одного пользователя в день:

* 30 кБ + 2461.2 кБ + 1845.9 кБ + 467.72 кБ= 4804.82 кБ ≈ 4.8 МБ

### Сетевой трафик по видам активности (дневная аудитория 24.2 млн. пользователей):

Пиковое значение активности пользователей(соответственно RPS тоже) приблизительно в 1.66 раза выше среднего значения. Возьмем коэффициент запаса равный 2

Тип                           | Отправка (дневная аудитория 24.2 млн) | Отправка Гб/сек | Пиковое значение | Значение с коэффициентом запаса 2 |
-------------                 | ------------------------------------  |---------------- |----------------- |---------------------------------- |
Поиск товаров                 | 24.2 млн * 30 кБ = 726 ГБ             | 0.0084          | 0.0139           | 0.0168                            |
Добавление товаров в корзину  | 24.2 млн * 2461.2 кБ = 59 610 ГБ      | 0.689           | 1.14             | 1.38                              |
Оформление заказа             | 24.2 млн * 1845.9 кБ = 44 640 ГБ      | 0.515           | 0.855            | 1.03                              |
Оставление отзывов            | 24.2 млн * 467.72 кБ = 11 314 ГБ      | 0.131           | 0.217            | 0.262                             |
Итого                         | 116 290 ГБ ≈ 116 ТБ	                  | 0.0084          | 2.23             | 2.69                              |

### RPS
 
* Поиск товаров: 24.2 млн * 3 / 86400 = 839 RPS
* Добавление товаров в корзину: 24.2 млн * 4 / 86400 = 1120 RPS
* Оформление заказов: 24.2 млн. * 1 / 86400 = 280 RPS
* Оставление отзывов: 24.2 млн. * 2 / 86400 = 560 RPS
* Добавление товаров продавцом: 24.2 млн. * 1 / 86400 = 280 RPS

Действие                            | RPS  | Пиковое значение | Пиковое значение с коэффициентом запаса 2  |
------------------------------------| ---  |----------------- |------------------------------------------- |
Поиск товаров                       | 839  | 1393             | 2786                                       |
Добавление товаров в корзину        | 1120 | 1859             | 3718                                       |
Оформление заказов                  | 280  | 465              | 930                                        |
Оставление отзывов                  | 560  | 930              | 1860                                       |
Добавление товаров продавцом        | 280  | 465              | 930                                        |
**Итого**                           | 3079 | 5112             | 10224                                      | 

# Список источников

1. https://www.similarweb.com/ru/website/wildberries.ru/#demographics
2. https://oborot.ru/news/kolichestvo-posetitelej-marketplejsov-wildberries-i-ozon-v-mesyac-sravnyalos-kuda-eshhe-hodyat-pokupateli-i209527.html
3. https://dzen.ru/a/ZkT8wKCKkBgtJMT-
4. https://adindex.ru/news/researches/2023/02/28/310879.phtml
5. https://dzen.ru/a/ZkT8wKCKkBgtJMT-
6. https://www.vedomosti.ru/business/articles/2024/05/05/1035562-ozon-i-wildberries
7. https://www.cnews.ru/news/line/2023-06-08_wildberries_itogi_i_kvartala_2023
